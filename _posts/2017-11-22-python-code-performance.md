---
layout:     post
title:      Python代码优化Tips
keywords:   博客
categories: [Python]
tags:	    [Python，代码优化]
---

尽管强烈反对过早优化，但在Python代码中一点点的优化都可能带来巨大的性能提升。   

* 使用join()方法代替+

在Python中，字符串对象是不可改变的。使用+连接字符串时，都将创建一个新的字符串对象，即需要重新开辟空间，把连接起来的字符串放入新的空间，因此N个字符串相加必将丢弃N-1个结果，而列表不同，列表是可以该表的，使用list.append，再使用join方法，只内建了一次，节省了很多资源和时间。   
 

* 使用xrange代替range  

在Python2.x 中这样做，因为Python3.x中是默认的。xrange是range的C实现。  

range会预先生成范围内所有的整数，存入一个List中，然后返回List，我们知道List的append的操作是额外消耗内存的。   

使用range的流程是：创建一个完整的List，返回List，调用List的iter函数，返回一个迭代器。事实上，我们只需要一个迭代器，但是却创建了一个列表.使用range时，预先分配List的内存也很要命（列表至少占用36个字节，每增加一个元素，增加4个字节）。     

xrange不会预先生成所有的数字，通过yield，每次被请求时，yield只会生成并返回一个对象，当超出range时，StopIteration会抛出。从内存看，一个N个元素的loop，相比xrange，range会多消耗N倍的内存。    

使用xrange的流程是：xrange会直接返回一个迭代器。我们可以看到range的流程更为复杂，做了很多额外的操作，消耗的计算和内存资源更多。   

* 使用with语句   

为了避免忘记或者为了避免每次都要手动关闭文件，我们可以使用with语句（一种语法糖，语法糖语句通常是为了简化某些操作而设计的）。with语句会在其代码块执行完毕之后自动关闭文件。   

    with open('file.txt', 'w') as f:
        f.write(result)

with语句不仅仅可以用于文件操作，它实际上是一个很通用的结构，允许使用所谓的上下文管理器（context manager）。上下文管理器是一种支持__enter__()和__exit__()这两个方法的对象。__enter__()方法不带任何参数，它在进入with语句块的时候被调用，该方法的返回值会被赋值给as关键字之后的变量。__exit__()方法带有3个参数：type（异常类型）, value（异常信息）, trace（异常栈），当with语句的代码块执行完毕或执行过程中因为异常而被终止都会调用__exit__()方法。正常退出时该方法的3个参数都为None，异常退出时该方法的3个参数会被分别赋值。如果__exit__()方法返回值（真值测试结果）为True则表示异常已经被处理，命令执行结果中就不会抛出异常信息了；反之，如果__exit__()方法返回值（真值测试结果）为False，则表示异常没有被处理并且会向外抛出该异常。        

file类的__exit__()方法的返回值为None，None的真值测试结果为False，因此用于文件读写的with语句代码块中的异常信息还是会被抛出来，需要我们自己去捕获并处理。   

注意： 上面所说的__exit__()方法返回值（真值测试结果）为True则表示异常已经被处理，指的是with代码块中出现的异常。它对于with关键字之后的代码中出现的异常是不起作用的，因为还没有进入上下文管理器就已经发生异常了。因此，无论如何，还是建议在必要的时候在with语句外面套上一层try...except来捕获和处理异常。    



  
