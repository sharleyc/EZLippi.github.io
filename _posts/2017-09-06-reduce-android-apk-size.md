---
layout:     post
title:      Android包瘦身方法总结
keywords:   博客
categories: [Android]
tags:	    [Android]
---

随着业务的发展，很多的Android应用安装包会越来越大，为了降低用户下载体验应用的门槛，需要减少安装包的大小，俗称安装包瘦身。本文总结了常用的几种瘦身方法。


# 图片


* 在视觉要求不是特别高的场景中，对于体积比较大的图片（10K以上），采用有损压缩
* 小尺寸，色彩数少，或者有alpha通道透明度的时候，使用PNG；大尺寸，色彩渐变色多的用JPG。
>PNG是一种无损格式，JPG是有损格式。JPG在处理颜色很多的图片时，根据压缩率的不同，有时会去掉一些肉眼识别差距较小的中间颜色。而PNG会严格保留所有的色彩数。所以，在图片尺寸大，或者色彩数量多（特别是渐变色的多的时候），PNG的体积会明显大于JPG。

* 使用点9图技术，可以将图片横向和纵向同时进行拉伸，实现在多分辨率下的完美显示效果。由于只需要采用一套界面切图去适配不同的分辨率，可以大幅减少安装包的大小。而且程序不需要专门做处理就可以实现其拉伸，也减少了代码量和开发工作量。
>点9图是Android平台应用软件开发里的一种特殊的图片形式，扩展名为.9.png。点9图的格式相当于把一张PNG图分成了9个部分（九宫格），分别为4个角，4条边，以及一个中间区域。4个角是不做拉伸的，所以还能一直保持圆角的清晰状态，而2条水平边和垂直边分别只做水平和垂直拉伸，所以不会出现边会被拉粗的情况，只有中间的区域做拉伸。其结果就是拉伸时图片不会走样。

* 无用图片的梳理，建议联合设计师一起，人工检查确认并删除。
>因为App在版本的迭代开发中，可能会遗留下许多以前版本使用的图片，但是新版本已经不再使用了。不过又由于种种原因，这些图片的引用还残留在代码或者XML布局文件中，以至于lint扫描时不能被处理。

# 其它资源

* 通过Lint等工具，可以找出已不再使用的资源，包括图片，音频，视频，本地化资源，并进行删除，以达到瘦身的目的。
* 除了图像的有损压缩外，还有很多数据可以进行有损压缩：比如，mp4文件可以使用ffmpeg工具压缩，JS文件可以使用Closure Compiler进行压缩等。因为是有损压缩，所以无法完全还原压缩前的内容，需要在压缩率和效果上进行权衡。
* 资源的网络化。排查可以延后加载的资源，把更多的资源配置在后台，当用户使用时，进行在线下载，以减少本地安装包内的资源，减少安装包的大小。
* 屏幕适配取舍。针对目前市场安卓的情况，推荐主要适配xdpi，其余屏幕在xdpi资源不能满足，出现较大失真或者拉伸情况下，针对性的对单个资源进行匹配。
* 资源复用。对于相同的元素，比如确认、返回等按钮，尽量使用同一份，既保证项目有统一的风格，又能减少安装包的大小。


# 代码

* 不重要的模块Web化。
* 重构整合，去掉不再使用的库，代码，整合重复的代码逻辑。
* 使用proguard混淆代码，它会对不用的代码做优化，并且混淆后也能够减少安装包的大小
>Android SDK tools里面集成了一个Proguard工具。在Proguard的官方文档里是这么介绍的：Proguard是一个免费的Java类文件压缩、优化、混淆和预先验证的工具，它可以检测和移除未使用的类、字段、方法、属性，优化字节码并移除未使用的指令，最后它还能将代码中的类、字段、方法的名字改成短的、无意义的名字。所以，对代码进行Proguard后，也可以比较大的减小代码体积（即dex的体积），并且可以增加代码被反编译的难度，一定程度上保护了代码的安全。

* native code的部分，大多数情况下只需要支持armabi与x86的架构即可。如果非必须，可以考虑拿掉x86的部分。
* 使用代码进行图片绘制，纯色的图片很容易使用代码实现。
* 图片改文字，将文字和图片分离。不少含有文字的图片是直接由切图来实现的，本地化这些切图，需要大量的视觉设计和图片。将文字按照特殊要求“画”到图片上，既减少了设计的压力，又可以显著减小安装包的大小。

# 其它

* 插件化
* 编译的优化
* 提高zip的压缩级别，对压缩文件进行重新压缩