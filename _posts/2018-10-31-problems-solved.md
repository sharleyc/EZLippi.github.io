---
layout:     post
title:      机器学习问题阶段性回顾
keywords:   博客
categories: [机器学习]
tags:	    [Tensorflow, GPU, 安装]
---

最近在尝试用深度学习模型解决一个项目中的问题。这篇文章会首先回顾走到现在经历了几个阶段，以及最近遇到的几个问题。


# 回顾过去  

## 入门阶段

如果你具备以下基础，那么会比较有帮助：

1、数学方面的基础能力。比如线性代数和统计学等。      
2、Python编程基础。现在有非常多的机器学习框架，和机器学习算法库，最常用的就是python。

你可以通过各种书籍和视频去学习了解机器学习。我是从吴恩达的斯坦福机器学习网络教程起步的。整个课程学习下来，还是比较容易的，课程内容深入浅出，配合对应的练习题，可以帮助初学者迅速了解一些机器学习的概念，即使数学基础不好，不会Python编程，也不影响。

我花了半年时间集中学习了吴恩达的机器学习和深度学习课程。    

## 实践阶段  

要提高自己的能力，关键是要多练，仅仅完成课程的习题是远远不够的。实践的渠道有两种，一种是加入项目，一种是参加机器学习竞赛，比如Kaggle。

前面提到了我现在正加入一个项目，在实践中会遇到各种各样的问题，为了解决这些问题，有时我不得不回头再去温习理论知识，查看各种资料。这是一个实践和理论互相促进的过程。



# 遇到的问题

## 迁移学习 

吴恩达（Andrew Ng）曾经说过：迁移学习将会是继监督学习之后的下一个机器学习商业成功的驱动力。在许多实际项目中，我们是没有足够数据的，而迁移学习能把一个领域(源领域)的知识，迁移到另外一个领域(目标领域)，使得目标领域能够取得更好的学习效果。

比如，我正在做的项目，就是基于迁移学习的图像分类问题。

## 未知分类

在我们准备好图像分类器后，遇到的一个比较大的问题是未知分类问题。我们用训练好的图像分类器来检测训练数据里不存在的类别的图像时，分类器会给出错误的分类。通过查资料，我们发现这是一个老大难问题。一个识别花草植物的小程序，如果你让它处理杯子的图片，它认为这是蝴蝶兰。   

   ![](/images/images_2018/10-31_01.jpg) 

为什么会发生这种情况？ 因为训练过程假设模型面对的每个样本一定都是属于这些类别的其中一种物体，而且预测结果也在这个集合的范围内。   

解决方案是什么？我们试过两种方案：一种是添加一个未知分类，但是效果并不理想；一种是将模型的训练数据和实际数据匹配起来，原来的模型目标是识别两种分类图片，为了解决未知分类问题，我们尝试把这些未知分类的图片根据其特征分成更多的分类，并放到训练过程中，效果要好很多，随之而来的一个新问题是，更多分类中的样本数太少，各个分类的样本数不均衡，这也会影响模型效果。

更复杂的方案是，编写一个独立的分类器，去识别那些主分类器不能识别的情况，它更像是一个过滤器。这个方案还有待尝试。

## 数据集

我们做迁移学习选择的模型是inception v3，咨询了公司内部专门做机器学习的两个同事关于样本数的问题，一个同事说至少3000以上，另一个同事说至少1万以上，并且各分类的样本数要均衡，比例不宜大于3：2。通过增加样本数和均衡样本数，确实解决了一个困扰我们比较久的问题，在二分类的实验中取得了100%的准确度。不过，因为各种原因，在项目中我们还无法做到每个分类的样本数和均衡性，这是个比较头痛的问题。

在数据集上遇到的另一个问题是，训练数据的有效性检查。为了加大样本数，我们用自动化脚本的方式获得了更多的样本图片，模型训练的时候在执行以下语句时，抛出了IOError，错误信息内容是OSError: broken data stream when reading image file。  

    img = img.convert('RGB')  

数据预处理时会检查样本中每张图片的格式，如果不是'RGB'格式就会先转换成'RGB'格式。由于增加的图片都是'RGBA'格式的，需要做转换。解决方法是，写了一个脚本循环遍历所有的样本图片进行格式转换，找出无法正常转换格式的图片，并把它从样本图片中删除即可。

	from PIL import Image
	import os
	
	for file_name in os.listdir(path):
	    try:
	        img = Image.open(path + file_name)
	        if img.mode != "RGB":
	            img_rgb = img.convert("RGB")
	            os.remove(path + file_name)
	            img_rgb.save(path + file_name)
	    except:
	        print(file_name)



### 参考资料

https://www.leiphone.com/news/201810/XaxbBhHOG93ZlYcd.html